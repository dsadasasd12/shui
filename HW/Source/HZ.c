#include "HZ.h"
#include "ccd_decode.h"


//uint8_t NUM[10][16] = {
//  {0x00,0x07,0x08,0x10,0x10,0x08,0x07,0x00,0x00,0xF0,0x08,0x04,0x04,0x08,0xF0,0x00},/*"0",0*/
//  
//  {0x00,0x00,0x08,0x08,0x1F,0x00,0x00,0x00,0x00,0x00,0x04,0x04,0xFC,0x04,0x04,0x00},/*"1",0*/
//  
//  {0x00,0x0E,0x10,0x10,0x10,0x10,0x0F,0x00,0x00,0x0C,0x14,0x24,0x44,0x84,0x0C,0x00},/*"2",0*/
//
//  {0x00,0x0C,0x10,0x10,0x10,0x11,0x0E,0x00,0x00,0x18,0x04,0x84,0x84,0x44,0x38,0x00},/*"3",0*/
//
//  {0x00,0x00,0x01,0x02,0x0C,0x1F,0x00,0x00,0x00,0x60,0xA0,0x24,0x24,0xFC,0x24,0x24},/*"4",0*/
//  
//  {0x00,0x1F,0x11,0x11,0x11,0x10,0x10,0x00,0x00,0x98,0x04,0x04,0x04,0x88,0x70,0x00},/*"5",0*/
//  
//  {0x00,0x07,0x08,0x11,0x11,0x09,0x00,0x00,0x00,0xF0,0x88,0x04,0x04,0x04,0xF8,0x00},/*"6",0*/
//
//  {0x00,0x18,0x10,0x10,0x11,0x16,0x18,0x00,0x00,0x00,0x00,0x7C,0x80,0x00,0x00,0x00},/*"7",0*/
//
//  {0x00,0x0E,0x11,0x10,0x10,0x11,0x0E,0x00,0x00,0x38,0x44,0x84,0x84,0x44,0x38,0x00},/*"8",0*/
//
//  {0x00,0x0F,0x10,0x10,0x10,0x08,0x07,0x00,0x00,0x80,0x48,0x44,0x44,0x88,0xF0,0x00},/*"9",0*/
//
//};
uint8_t zm[15][16] = {

//  
//  {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0C,0x0C,0x00,0x00,0x00,0x00,0x00},/* 1*/ 
//  
  {0x00,0x02,0x02,0x02,0x02,0x02,0x02,0x00,0x00,0x40,0x40,0x40,0x40,0x40,0x40,0x00},/*"=",0*/
//  
  {0x00,0x10,0x08,0x04,0x02,0x01,0x00,0x00,0x00,0x04,0x08,0x10,0x20,0x40,0x80,0x00},/*">",1*/
//  
//  {0x00,0x02,0x03,0x1E,0x02,0x03,0x1E,0x00,0x00,0x20,0xFC,0x20,0x20,0xFC,0x20,0x00},/*"#",4*/
//  
//  {0x00,0x00,0x00,0x7F,0x40,0x40,0x40,0x00,0x00,0x00,0x00,0xFE,0x02,0x02,0x02,0x00},/*"[",5*/
//  
//  {0x10,0x1F,0x1F,0x00,0x1F,0x1F,0x10,0x00,0x04,0xFC,0x80,0x7C,0x80,0xFC,0x04,0x00},/*"M",6*/
//  
//  {0x10,0x1F,0x11,0x11,0x17,0x10,0x08,0x00,0x04,0xFC,0x04,0x04,0xC4,0x04,0x18,0x00},/*"E",7*/
//  
//  {0x00,0x00,0x03,0x1C,0x07,0x00,0x00,0x00,0x04,0x3C,0xC4,0x40,0x40,0xE4,0x1C,0x04},/*"A",8*/
//  
//  {0x00,0x0E,0x11,0x10,0x10,0x10,0x1C,0x00,0x00,0x1C,0x04,0x84,0x84,0x44,0x38,0x00},/*"S",9*/
//  
//  {0x00,0x40,0x40,0x40,0x7F,0x00,0x00,0x00,0x00,0x02,0x02,0x02,0xFE,0x00,0x00,0x00},/*"]",10*/
//  
//  {0x00,0x0F,0x08,0x08,0x08,0x08,0x0D,0x07,0x00,0xF0,0x80,0x80,0x80,0x80,0x00,0x00},/*"P",11*/
//  
//  {0x00,0x00,0x10,0x10,0x1F,0x10,0x10,0x00,0x03,0x01,0x01,0x01,0xFE,0x00,0x00,0x00},/*"J",12*/
//  
//  {0x00,0x00,0x00,0x03,0x03,0x00,0x00,0x00,0x00,0x00,0x00,0x0C,0x0C,0x00,0x00,0x00},/*":",13*/
//  
//  {0x10,0x1F,0x0C,0x03,0x00,0x10,0x1F,0x10,0x04,0xFC,0x04,0x00,0xE0,0x18,0xFC,0x00},/*"N",14*/
//  
//  {0x00,0x0E,0x11,0x10,0x10,0x10,0x1C,0x00,0x00,0x1C,0x04,0x84,0x84,0x44,0x38,0x00},/*"S",15*/

  
//  {0x10,0x1F,0x11,0x11,0x11,0x11,0x0E,0x00,0x04,0xFC,0x04,0x00,0xC0,0x30,0x0C,0x04},/*"R",16*/
//  
//  {0x10,0x1F,0x11,0x11,0x17,0x10,0x08,0x00,0x04,0xFC,0x04,0x04,0xC4,0x04,0x18,0x00},/*"E",17*/
//  
//  {0x10,0x1F,0x10,0x10,0x10,0x10,0x0F,0x00,0x04,0xFC,0x84,0x80,0x80,0x80,0x00,0x00},/*"P",18*/
//  
//  
//  {0x10,0x1F,0x11,0x11,0x17,0x10,0x08,0x00,0x04,0xFC,0x04,0x04,0xC4,0x04,0x18,0x00},/*"E",19*/
//  
//  {0x10,0x1F,0x0C,0x03,0x00,0x10,0x1F,0x10,0x04,0xFC,0x04,0x00,0xE0,0x18,0xFC,0x00},/*"N",20*/
//  
//  {0x18,0x10,0x10,0x1F,0x10,0x10,0x18,0x00,0x00,0x00,0x04,0xFC,0x04,0x00,0x00,0x00},/*"T",21*/
//  
//  {0x10,0x1F,0x11,0x11,0x17,0x10,0x08,0x00,0x04,0xFC,0x04,0x04,0xC4,0x04,0x18,0x00},/*"E",22*/
//
//  {0x00,0x0E,0x11,0x10,0x10,0x10,0x1C,0x00,0x00,0x1C,0x04,0x84,0x84,0x44,0x38,0x00},/*"S",23*/
//
//  {0x03,0x0C,0x10,0x10,0x10,0x10,0x1C,0x00,0xE0,0x18,0x04,0x04,0x04,0x08,0x10,0x00},/*"C",24*/
//  
//  
//  {0x01,0x01,0x00,0x01,0x01,0x00,0x00,0x00,0x01,0xFF,0x89,0x04,0x04,0x88,0x70,0x00},/*"p",25*/
//  
//  {0x00,0x00,0x00,0x00,0x01,0x06,0x18,0x20,0x00,0x06,0x18,0x60,0x80,0x00,0x00,0x00},/*"/",26*/
//  
  {0x00,0x07,0x08,0x10,0x10,0x08,0x07,0x00,0x00,0xF0,0x08,0x04,0x04,0x08,0xF0,0x00},/*"0",2*/
  
  {0x00,0x08,0x08,0x1F,0x00,0x00,0x00,0x00,0x00,0x04,0x04,0xFC,0x04,0x04,0x00,0x00},/*"1",3*/

  {0x00,0x0E,0x10,0x10,0x10,0x11,0x0E,0x00,0x00,0x0C,0x14,0x24,0x44,0x84,0x0C,0x00},/*"2",4*/

  
  {0x00,0x0C,0x10,0x11,0x11,0x12,0x0C,0x00,0x00,0x18,0x04,0x04,0x04,0x88,0x70,0x00},/*"3",5*/
  
  {0x00,0x00,0x03,0x04,0x08,0x1F,0x00,0x00,0x00,0xE0,0x20,0x24,0x24,0xFC,0x24,0x00},/*"4",6*/
  
  {0x00,0x1F,0x10,0x11,0x11,0x10,0x10,0x00,0x00,0x98,0x84,0x04,0x04,0x88,0x70,0x00},/*"5",7*/
  
  {0x00,0x07,0x08,0x11,0x11,0x18,0x00,0x00,0x00,0xF0,0x88,0x04,0x04,0x88,0x70,0x00},/*"6",8*/
  
  {0x00,0x1C,0x10,0x10,0x13,0x1C,0x10,0x00,0x00,0x00,0x00,0xFC,0x00,0x00,0x00,0x00},/*"7",9*/
  
  {0x00,0x0E,0x11,0x10,0x10,0x11,0x0E,0x00,0x00,0x38,0x44,0x84,0x84,0x44,0x38,0x00},/*"8",10*/
  
  {0x00,0x07,0x08,0x10,0x10,0x08,0x07,0x00,0x00,0x00,0x8C,0x44,0x44,0x88,0xF0,0x00},/*"9",11*/
  
  
  
  {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0C,0x0C,0x00,0x00,0x00,0x00,0x00},/*".",12*/
  {0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x00,0x04,0xFC,0x04,0x00,0xFC,0x04,0x00,0xFC},/* m 13 */
  {0xF0,0xF0,0x0F,0x09,0x09,0x0F,0xF0,0xF0,0xFF,0xFF,0x80,0x80,0x80,0x80,0xFF,0xFF},

//  {0x10,0x1F,0x11,0x11,0x11,0x0E,0x00,0x00,0x04,0xFC,0x04,0x04,0x04,0x88,0x70,0x00},/*"B",38*/
//  
//  {0x10,0x1F,0x11,0x11,0x17,0x10,0x08,0x00,0x04,0xFC,0x04,0x00,0xC0,0x00,0x00,0x00},/*"F",39*/
//  
//  {0x00,0x10,0x10,0x1F,0x10,0x10,0x00,0x00,0x00,0x04,0x04,0xFC,0x04,0x04,0x00,0x00},/*"I",40*/
//  
//  {0x00,0x00,0x00,0x07,0x18,0x20,0x40,0x00,0x00,0x00,0x00,0xE0,0x18,0x04,0x02,0x00},/*"(",41*/
//
//  {0x00,0x40,0x20,0x18,0x07,0x00,0x00,0x00,0x00,0x02,0x04,0x18,0xE0,0x00,0x00,0x00},/*")",42*/
// 
//  {0x10,0x1F,0x1F,0x00,0x1F,0x1F,0x10,0x00,0x04,0xFC,0x80,0x7C,0x80,0xFC,0x04,0x00},/*"M",43*/
//  
//  {0x08,0x0F,0x00,0x00,0x01,0x01,0x01,0x00,0x04,0xFC,0x24,0x60,0x94,0x0C,0x04,0x00},/*"k",44*/

};
uint16_t code_bar_width[30];
uint8_t elcr[][10];
void Write_HZ(uint8_t x,uint8_t y,uint8_t index,uint8_t size,uint8_t **buf)
{
 
  //uint8_t temp; 
  uint8_t hsize;
  uint8_t tempx;
  uint8_t y0;       //保存起始坐标中的y值
  y0 = y;
  hsize = (((size/8)+((size%8)?1:0))*size);
  for(uint8_t s = 0; s < hsize; s++)
  {
    tempx = buf[index][s];
    for(uint8_t n = 0; n < 8; n++)
    {
//      switch(temp&)
//      {
//        case temp&0x01:draw_point(x+1,y);
//        case temp&0x02:draw_point(x+2,y);
//        case temp&0x04:draw_point(x+3,y);
//        case temp&0x08:draw_point(x+4,y);
//        case temp&0x10:draw_point(x+5,y);
//        case temp&0x20:draw_point(x+6,y);
//        case temp&0x40:draw_point(x+7,y);
//        case temp&0x80:draw_point(x+8,y);
//        
//      }
        
      
      if(tempx&0x01)
        draw_point(x,y);
      tempx >>= 1;
      y = y-1;
      if(y0 - y >= size)
      {
        y = y0;
        x++;
        
      }
    }
  
  }
}

void write_Hz(uint8_t x,uint8_t y,uint8_t (*buf)[16],uint8_t num)
{
    uint8_t x11;    
    x11 = x;
    for(uint8_t n = 0; n <2 ; n++)
    {
     y -=1;
     for(uint8_t u = 0; u<16; u++)
     {       
       cmd(y|0xb0);
       cmd((x>>4)|0x10);
       cmd(x&0x0f);
       data(buf[n+num*2][u]);
       x+=1;       
     }
     if(x >= 16 + x11)
     {
       x = x11;
     }
  }
}
/*@pram show:电池电量显示
*/
void write_Ele(uint8_t x,uint8_t y,uint8_t show,uint8_t *pic)
{
  for(uint8_t n = 0; n < 10; n++)
  {
    cmd(y|0xb0);
    cmd((x>>4)|0x10);
    cmd(x&0x0f);
    
    x+=1;
  }
}
/*显示数字*/
void write_num(uint8_t x,uint8_t y,uint8_t num)
{
  uint8_t y0,x0;
  for(uint8_t i = 0; i < 2; i++)
  {
    y0 = y;
    x0 = x;
    for(uint8_t j = 0; j < 8; j++)
    {
      cmd(y|0xb0);
      cmd((x>>4)|0x10);
      cmd(x&0x0f);
      data(zm[num+27][8*i+j]);
      x += 1;
      if(x >= x0 + 8)
      {
        x = x0;
      }
    }
    y -= 1;
    if(y == y0 + 1)
    {
      y = y0;
    }
  }
}
/*显示字母*/
void write_zm(uint8_t x,uint8_t y,uint8_t num)
{
  uint8_t y0,x0;
  for(uint8_t i = 0; i < 2; i++)
  {
    y0 = y;
    x0 = x;
    for(uint8_t j = 0; j < 8; j++)
    {
      cmd(y|0xb0);
      cmd((x>>4)|0x10);
      cmd(x&0x0f);
      data(zm[num][8*i+j]);
      x += 1;
      if(x >= x0 + 8)
      {
        x = x0;
      }
    }
    y -= 1;
    if(y == y0 + 1)
    {
      y = y0;
    }
  }
}
float jishu;
uint16_t s1[6];
uint32_t d1[2];
/*取出adc_value中的各个数字*/
void getnum(float n)
{
  uint8_t pre = 0;
  jishu = n;
  if(n < 1000)
  {  
    s1[0] = (uint16_t)jishu%10;   //个位
    //      code_bar_width[3] = s1[0];
    s1[1] = (uint16_t)jishu/10%10;  //十位
    //      code_bar_width[2] = s1[1];
    s1[2] = (uint16_t)jishu/100%10; //百位
    
    //s1[3] = (uint8_t)jishu/1000%10;//千位
    d1[0] = jishu*10;
    s1[3] = (uint16_t)(d1[0])%10;  //十分位
    d1[1] = jishu*100;
    s1[4] = (uint16_t)(d1[1]%10); //百分位
  }
  else
  {
    s1[0] = (uint16_t)jishu%10;   //个位
    //      code_bar_width[3] = s1[0];
    s1[1] = (uint16_t)jishu/10%10;  //十位
    //      code_bar_width[2] = s1[1];
    s1[2] = (uint16_t)jishu/100%10; //百位
    
    s1[3] = (uint16_t)jishu/1000%10;//千位
    d1[0] = jishu*10;
    s1[4] = (uint16_t)d1[0]%10;  //十分位
    d1[1] = jishu*100;
    s1[5] = (uint16_t)(d1[1]%10); //百分位
  }
  //      code_bar_width[1] = s1[2];
  //      s1[3] = s1[2]%10;
  //      code_bar_width[0] = s1[3];
  
  if(s1[5] == 0)
  { 
    write_num(10,4,0);    //0
    write_zm(20,4,1);     //.
    write_num(30,4,s1[2]);//百位
    write_num(40,4,s1[1]);//十位
    write_num(50,4,s1[0]);//个位
    
    write_num(60,4,s1[3]);//十分位
    write_num(70,4,s1[4]);//百分位
    write_zm(80,4,0);
    if(pre == 1)
    {
      write_zm(80,4,0);
    }
    
  }
  if(s1[5] != 0)
  {      
    write_num(10,4,s1[3]);//千位
    write_zm(20,4,1);     // .
    
    write_num(30,4,s1[2]);//百位
    write_num(40,4,s1[1]);//十位
    write_num(50,4,s1[0]);//个位
    
    write_num(60,4,s1[4]);//十分位
    write_num(70,4,s1[5]);//百分位
    write_zm(80,4,0);  
    if(pre == 1)
    {
      write_zm(90,4,0);
    }
  }
    
}
/*显示码条宽度*/
uint8_t i_num;
void show_bar_code()
{
//  uint8_t i;                           //动态判断码条编码数量
//  while(in[i++] != 0)
//  {
//    i_num++;
//    i = 0;
//  }
  for(uint8_t i = 0; i < 14 ; i++)
  {
    
    write_num(i*9,5,code_bar_width[i]);
  }
}